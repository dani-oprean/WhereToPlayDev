@model WhereToPlay.Models.DB.Court
@{ ViewBag.Title = "Rezerva teren"; }
<link href="~/Content/datepicker.css" rel="stylesheet" />


@using (Html.BeginForm("Rent", "Courts", FormMethod.Post))
{
    @Html.AntiForgeryToken()
    <div id="cdMasterPane">
        <div id="cdLeftPane">
            <p id="cdHeader">@Html.DisplayFor(model => model.Sport.SportName) / @Html.DisplayFor(model => model.CourtName)</p>
            <p>@Html.HiddenFor(model => model.IDCourt)</p>
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            <p id="cdAdresa">
                <b>Adresa:</b>
                Str.
                @Html.DisplayFor(model => model.Address.AddressStreet)
                Nr.
                @Html.DisplayFor(model => model.Address.AddressNumber)
                Oras
                @Html.DisplayFor(model => model.Address.AddressCity)
                Judet
                @Html.DisplayFor(model => model.Address.AddressCounty)
                <br />
                @if (@Model.PhoneNumber != null && @Model.PhoneNumber != "")
                {
                    <b>Telefon: </b>
                    @Html.DisplayFor(model => model.PhoneNumber)
                }
                <br />
                @if (@Model.EmailAddress != null && @Model.EmailAddress != "")
                {
                    <b>Email: </b>
                    @Html.DisplayFor(model => model.EmailAddress)
                }
            </p>
            <dl>
                <dt>
                    @Html.DisplayNameFor(model => model.Length)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.Length)
                </dd>

                <dt>
                    @Html.DisplayNameFor(model => model.Width)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.Width)
                </dd>


                <dt>
                    @Html.DisplayNameFor(model => model.SessionPrice)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.SessionPrice)
                </dd>

            </dl>

            <dl class="dl-horizontal">

                <dt>
                    @Html.Label("", "Selecteaza data")
                </dt>

                <dd>
                    @Html.TextBox("selectedDate", "", new { @class = "date-picker" })
                </dd>

                <dt>
                    @Html.Label("", "Ore disponibile")
                </dt>

                <dd>
                    @Html.Partial("CourtReservationTime",
                new WhereToPlay.Models.ViewModel.CourtReservation
                {
                    NZeceDoispe = false,
                    NDoispePaispe = false,
                    NPaispeSaispe = false,
                    NSaispeOptspe = false,
                    NOptspeDouazeci = false,
                    NDouazeciDouajdoi = false
                })
                </dd>
            </dl>

            <div class="form-group">
                <div class="col-md-offset-2 col-md-10">
                    <input type="submit" value="Rezerva" class="btn btn-default" />
                </div>
            </div>

            <div>
                <p>@Html.ActionLink("Inapoi la terenuri", "Index", "Home")</p>
            </div>
        </div>

        <div id="cdRightPane">
            <div>
                @{
                    if (Model.FileName1 != null)
                    {
                        string imageBase64 = Convert.ToBase64String(Model.Content1);
                        string imageSrc = string.Format("data:image/jpeg;base64,{0}", imageBase64);
                        <img src="@imageSrc" style="height:200px;width:300px;" />
                    }
                }
            </div>
            <div>
                @{
                    if (Model.FileName2 != null)
                    {
                        string imageBase64 = Convert.ToBase64String(Model.Content2);
                        string imageSrc = string.Format("data:image/jpeg;base64,{0}", imageBase64);
                        <img src="@imageSrc" style="height:200px;width:300px;" />
                    }
                }
            </div>
            <div>
                @{
                    if (Model.FileName3 != null)
                    {
                        string imageBase64 = Convert.ToBase64String(Model.Content3);
                        string imageSrc = string.Format("data:image/jpeg;base64,{0}", imageBase64);
                        <img src="@imageSrc" style="height:200px;width:300px;" />
                    }
                }
            </div>
        </div>
    </div>
}

<div id="map_canvas" style="width: 480px; height: 320px;">
</div>  

<script src="~/Scripts/jquery-ui-1.11.4.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
<script src="~/Scripts/jquery.unobtrusive-ajax.js"></script>
<script>
    $(function () {
        $('.date-picker').datepicker({
            changeYear: true,
            inline: true,
            showOtherMonths: true,
            dayNamesMin: ['Du', 'Lu', 'Ma', 'Mi', 'Jo', 'Vi', 'Sa'],
            monthNames: ['Ianuarie', 'Februarie', 'Martie', 'Aprilie', 'Mai', 'Iunie',
                'Iulie', 'August', 'Septembrie', 'Octombrie', 'Noiembrie', 'Decembrie'],
            monthNamesShort: ['Ian', 'Feb', 'Mar', 'Apr', 'Mai', 'Iun',
                'Iul', 'Aug', 'Sep', 'Oct', 'Noi', 'Dec'],
            nextText: '&rarr;',
            prevText: '&larr;',
            dateFormat: 'dd.mm.yy',
            onSelect: function (date) {
                $.get("/Courts/ShowTimes", { dateRes: date, courtId : @Model.IDCourt })
                .done(function( data ) {
                    $("#timesList").html(data);
                });
                return false;
            }
        });
        //.datepicker("setDate", new Date())
    })
</script>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">

   $(document).ready(function () {
     initialize();
   });
   function initialize() {
       var address=document.getElementById("cdAdresa").innerText;
       address=address.replace("Adresa:", "");
       address=address.replace("Str.", "");
       address=address.replace("Nr.", "");
       address=address.replace("Oras", "");
       address=address.replace("Judet", "");



       var geocoder = new google.maps.Geocoder();
       var lat=0;
       var long=0;
       geocoder.geocode( { 'address': address}, function(results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
            lat = results[0].geometry.location.lat();
            long = results[0].geometry.location.lng();
        }

       var mapOptions = {
           center: new google.maps.LatLng(lat, long),
       zoom: 17,
       mapTypeId: google.maps.MapTypeId.ROADMAP
       };
     var map = new google.maps.Map(document.getElementById("map_canvas"),
       mapOptions);
     // create a marker
     var latlng = new google.maps.LatLng(lat, long);
     var marker = new google.maps.Marker({
       position: latlng,
       map: map,
       title: 'My Court'
     });
    });
   }
</script>  
